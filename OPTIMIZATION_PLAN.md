# æ¨¡å‹ä¼˜åŒ–åˆ†ææŠ¥å‘Š

## 1. å½±å“æ¨¡å‹è®­ç»ƒçš„å› ç´ åˆ†æ

å½“å‰æ¨¡å‹è¡¨ç°æå·®ï¼ˆLoss 7, Acc 0%ï¼‰è¡¨æ˜æ¨¡å‹æœªèƒ½æœ‰æ•ˆæ”¶æ•›ã€‚ç»ä»£ç å®¡æŸ¥ï¼Œä¸»è¦åŸå› åœ¨äº**è·¨æ¨¡æ€è¿ç§»å­¦ä¹ ç­–ç•¥ä¸å½“**ã€‚

### ğŸ”´ æœ€ä¸»è¦å› ç´ ï¼šEncoder å†»ç»“ç­–ç•¥é”™è¯¯

*   **ç°çŠ¶**: ä»£ç å†»ç»“äº† mT5 Encoder çš„å‰ 6 å±‚ï¼Œä»…å¾®è°ƒæœ€å 2 å±‚ã€‚
*   **é—®é¢˜**: mT5 çš„ Encoder æ˜¯ä¸º**æ–‡æœ¬è¾“å…¥**è®¾è®¡çš„ã€‚å½“å‰ç³»ç»Ÿçš„è¾“å…¥æ˜¯**å§¿æ€åæ ‡**ã€‚
*   **åŸç†**: é¢„è®­ç»ƒçš„æ–‡æœ¬ Encoder æƒé‡æœŸæœ›è¾“å…¥å…·æœ‰ç‰¹å®šçš„æ–‡æœ¬ Embedding åˆ†å¸ƒç‰¹å¾ã€‚å§¿æ€ç‰¹å¾ï¼ˆè¿ç»­åæ ‡å€¼ï¼‰ä¸æ–‡æœ¬ Embeddingï¼ˆç¦»æ•£ Token æ˜ å°„ï¼‰åœ¨ç»Ÿè®¡åˆ†å¸ƒå’Œè¯­ä¹‰ç©ºé—´ä¸Šå®Œå…¨ä¸åŒã€‚
*   **åæœ**: å°†å§¿æ€ç‰¹å¾è¾“å…¥ç»™**å†»ç»“çš„æ–‡æœ¬å¤„ç†å±‚**ï¼Œç›¸å½“äºå¯¹æ•°æ®è¿›è¡Œäº†éšæœºä¸”ä¸å¯é€†çš„æ‰°åŠ¨ã€‚åç»­å±‚æ— æ³•ä»è¿™äº›æ··ä¹±çš„æ¿€æ´»å€¼ä¸­æ¢å¤è¯­ä¹‰ä¿¡æ¯ã€‚**å¯¹äºä» Pose åˆ° Text çš„è·¨æ¨¡æ€ä»»åŠ¡ï¼ŒEncoder å¿…é¡»é€šè¿‡è®­ç»ƒæ¥é€‚é…æ–°çš„è¾“å…¥æ¨¡æ€ã€‚**

### ğŸŸ  æ¬¡è¦å› ç´ 

2.  **å‰ç«¯ç‰¹å¾æå–èƒ½åŠ›è–„å¼±**:
    *   ä»…ä½¿ç”¨ 2 å±‚ç®€å•çš„ GCN å’Œçº¿æ€§æ˜ å°„ã€‚ç›¸æ¯”äºä¸»æµçš„ 10+ å±‚ ResNet æˆ–å¤æ‚çš„æ—¶ç©º Transformerï¼Œè¯¥å‰ç«¯å¾ˆéš¾å°†åŸå§‹åæ ‡è½¬æ¢ä¸ºé«˜è´¨é‡çš„é«˜å±‚è¯­ä¹‰ç‰¹å¾ã€‚

3.  **ç»å¯¹ä½ç½®ä¿¡æ¯ç¼ºå¤±**:
    *   æ¨¡å‹å°†å§¿æ€åºåˆ—ç›´æ¥çº¿æ€§æ˜ å°„åè¾“å…¥ mT5ã€‚è™½ç„¶ T5 æœ‰ç›¸å¯¹ä½ç½®åç½®ï¼Œä½†ç¼ºä¹æ˜¾å¼çš„æ—¶åºæ³¨å…¥ï¼ˆå¦‚ Sinusoidal Encodingï¼‰ï¼Œå¯èƒ½å¯¼è‡´æ¨¡å‹å¯¹åŠ¨ä½œæ—¶åºï¼ˆå¼€å§‹/ç»“æŸ/æŒç»­æ—¶é•¿ï¼‰ä¸å¤Ÿæ•æ„Ÿã€‚

4.  **Label Smoothing å¹²æ‰°**:
    *   åœ¨æ¨¡å‹å®Œå…¨æ— æ³•æ‹Ÿåˆæ•°æ®æ—¶ï¼ˆLoss é«˜ï¼‰ï¼ŒLabel Smoothing (0.1) å¯èƒ½ä¼šæ©ç›–æ¨¡å‹é¢„æµ‹åˆ†å¸ƒè¿‡äºå‡åŒ€ï¼ˆUniformï¼‰çš„é—®é¢˜ï¼Œä½¿ Loss çœ‹èµ·æ¥ç¨³å®šä½†å®é™…ä¸Šæ¨¡å‹åœ¨â€œæ‘†çƒ‚â€ã€‚

---

## 2. æ¨¡å‹ä¼˜åŒ–æ­¥éª¤ (æŒ‰ä¼˜å…ˆçº§æ’åˆ—)

è¯·æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œä¼˜åŒ–ã€‚æ­¥éª¤ 1 æ˜¯å¿…é¡»æ‰§è¡Œçš„å…³é”®ä¿®å¤ã€‚

### ğŸ¥‡ æ­¥éª¤ä¸€ï¼šè§£å†» mT5 Encoder (Critical)

**ç›®æ ‡**: è®©æ¨¡å‹å­¦ä¼šç†è§£â€œå§¿æ€è¯­è¨€â€ã€‚
**æ“ä½œ**: ä¿®æ”¹ `models_lite.py`ï¼Œè§£å†» Encoder çš„æ‰€æœ‰å±‚ã€‚
**ä»£ç ä¿®æ”¹**:
```python
def _freeze_mt5_layers(self):
    # 1. å§‹ç»ˆè§£å†»æ‰€æœ‰ Encoder å±‚ (å› ä¸ºè·¨æ¨¡æ€è¾“å…¥)
    for param in self.mt5_model.encoder.parameters():
        param.requires_grad = True
        
    # 2. ä»…å†»ç»“ Decoder çš„å‰å‡ å±‚ (ä¿ç•™è¯­è¨€ç”Ÿæˆèƒ½åŠ›)
    for name, param in self.mt5_model.decoder.named_parameters():
        # ä¾‹å¦‚: å†»ç»“å‰ 4 å±‚ï¼Œå¾®è°ƒå 4 å±‚ (mT5-small é€šå¸¸æœ‰ 8 å±‚)
        if any(f'block.{i}.' in name for i in range(4)):
            param.requires_grad = False
        else:
            param.requires_grad = True
            
    # 3. å§‹ç»ˆè§£å†» Head å’Œ Norm
    self.mt5_model.lm_head.requires_grad = True
    self.mt5_model.final_layer_norm.requires_grad = True
```

### ğŸ¥ˆ æ­¥éª¤äºŒï¼šæ£€æŸ¥å¹¶éªŒè¯è¾“å…¥æ•°æ®

**ç›®æ ‡**: æ’é™¤â€œåƒåœ¾è¿›ï¼Œåƒåœ¾å‡ºâ€çš„å¯èƒ½æ€§ã€‚
**æ“ä½œ**: 
1. æ£€æŸ¥ `datasets_lite.py` ä¸­çš„ `crop_scale` é€»è¾‘ï¼Œç¡®ä¿æ²¡æœ‰å› æŸä¸ªæ ·æœ¬å…³é”®ç‚¹å…¨ 0 è€Œäº§ç”Ÿ NaNã€‚
2. ç¡®è®¤ `config_lite.py` ä¸­çš„ `max_length` è®¾ç½®ã€‚å¦‚æœå¤§å¤šæ ·æœ¬å¾ˆé•¿è€Œè¢«æˆªæ–­ä¸¥é‡ï¼Œä¼šä¸¢å¤±è¯­ä¹‰ã€‚

### ğŸ¥‰ æ­¥éª¤ä¸‰ï¼šè°ƒæ•´è¶…å‚æ•°ä»¥é€‚åº”å…¨å‚æ•°å¾®è°ƒ

**ç›®æ ‡**: ç¨³å®šè®­ç»ƒè¿‡ç¨‹ã€‚
**æ“ä½œ**:
*   **LR**: è§£å†»åå‚æ•°é‡å˜å¤§ï¼Œå»ºè®® `learning_rate = 1e-4` æˆ– `2e-4`ã€‚
*   **Batch Size**: å¦‚æœæ˜¾å­˜çˆ†äº†ï¼ˆè¿™æ˜¯å¯èƒ½çš„ï¼‰ï¼Œå°† `batch_size` è®¾ä¸º `2` ç”šè‡³ `1`ã€‚
*   **Accumulation**: ç›¸åº”å¢åŠ  `gradient_accumulation` (å¦‚è®¾ä¸º `16` æˆ– `32`)ï¼Œç¡®ä¿ `bs * accum >= 32`ã€‚

### ğŸ… æ­¥éª¤å››ï¼šå¢å¼ºå‰ç«¯ (å¯é€‰)

**ç›®æ ‡**: æå‡ç‰¹å¾è´¨é‡ã€‚
**æ“ä½œ**: åœ¨ `models_lite.py` ä¸­ï¼Œåœ¨ linear projection ä¹‹åï¼Œé€å…¥ mT5 ä¹‹å‰ï¼ŒåŠ å…¥ä¸€ä¸ªå¯å­¦ä¹ çš„ `nn.Parameter` ä½œä¸º Position Embeddingï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ `SinusoidalPositionalEncoding`ã€‚
